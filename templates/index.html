{% extends 'base.html' %}

{% block title %}LLM Code Assist{% endblock %}

{% block content %}
<!-- ============================================================
     SCREEN: DASHBOARD
     ============================================================ -->
<div id="screen-dashboard" class="screen flex flex-col">

  <!-- Dashboard Header -->
  <div class="flex items-center justify-between mb-8">
    <div>
      <h1 class="text-3xl font-bold gradient-text mb-1">Dashboard</h1>
      <p class="text-secondary">Manage your AI-powered projects</p>
    </div>
    <button class="btn btn-primary flex items-center gap-2" onclick="App.showScreen('create')" title="New Project (⌘N)">
      <i class="fas fa-plus"></i>
      <span>New Project</span>
      <kbd class="hidden md:inline-flex items-center gap-1 px-2 py-0.5 text-xs rounded"
           style="background:rgba(255,255,255,0.08);border:1px solid rgba(255,255,255,0.12);color:var(--text-muted);">
        ⌘N
      </kbd>
    </button>
  </div>

  <!-- Stats Row -->
  <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-8">

    <div class="stat-card">
      <div class="flex items-center gap-3">
        <div class="stat-icon" style="background:rgba(99,102,241,0.15);color:var(--accent-light);">
          <i class="fas fa-folder-open"></i>
        </div>
        <div>
          <div class="text-xs text-muted uppercase tracking-wider mb-1">Projects</div>
          <div class="text-2xl font-bold text-primary" id="stat-projects">0</div>
        </div>
      </div>
    </div>

    <div class="stat-card">
      <div class="flex items-center gap-3">
        <div class="stat-icon" style="background:rgba(99,102,241,0.15);color:var(--accent-light);">
          <i class="fas fa-robot"></i>
        </div>
        <div>
          <div class="text-xs text-muted uppercase tracking-wider mb-1">Model</div>
          <div class="text-2xl font-bold text-primary" id="stat-model">--</div>
        </div>
      </div>
    </div>

    <div class="stat-card">
      <div class="flex items-center gap-3">
        <div class="stat-icon" style="background:rgba(99,102,241,0.15);color:var(--accent-light);">
          <i class="fas fa-circle"></i>
        </div>
        <div>
          <div class="text-xs text-muted uppercase tracking-wider mb-1">Status</div>
          <div class="text-2xl font-bold text-primary">
            <span id="stat-status" class="status-badge online">Online</span>
          </div>
        </div>
      </div>
    </div>

  </div>

  <!-- Search Bar -->
  <div class="relative mb-6">
    <i class="fas fa-search absolute left-3 top-1/2 -translate-y-1/2"
       style="color:var(--text-muted);pointer-events:none;"></i>
    <input
      id="project-search"
      type="text"
      placeholder="Search projects..."
      class="input w-full pl-10"
      oninput="App.filterProjects(this.value)"
      autocomplete="off"
    />
  </div>

  <!-- Skeleton Loaders -->
  <div id="skeleton-projects" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4 mb-4">
    <div class="skeleton skeleton-card"></div>
    <div class="skeleton skeleton-card"></div>
    <div class="skeleton skeleton-card"></div>
  </div>

  <!-- Projects Grid -->
  <div id="projects-grid" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4 mb-4">
    <!-- Project cards injected by App.renderProjects() -->
  </div>

  <!-- Empty State -->
  <div id="no-projects" class="empty-state hidden">
    <div class="empty-state-icon">
      <i class="fas fa-folder-open"></i>
    </div>
    <h3 class="text-lg font-semibold text-primary mb-2">No projects yet</h3>
    <p class="text-secondary mb-6">Create your first AI-powered project to get started.</p>
    <button class="btn btn-primary flex items-center gap-2 mx-auto" onclick="App.showScreen('create')">
      <i class="fas fa-plus"></i>
      Create Your First Project
    </button>
  </div>

</div>
<!-- /SCREEN: DASHBOARD -->


<!-- ============================================================
     SCREEN: CREATE
     ============================================================ -->
<div id="screen-create" class="screen hidden flex flex-col">

  <!-- Header -->
  <div class="flex items-center gap-4 mb-8">
    <button class="btn btn-ghost flex items-center gap-2" onclick="App.showScreen('dashboard')">
      <i class="fas fa-arrow-left"></i>
    </button>
    <div>
      <h1 class="text-3xl font-bold gradient-text mb-1">New Project</h1>
      <p class="text-secondary">Describe what you want to build</p>
    </div>
  </div>

  <!-- Step Progress Indicator -->
  <div class="flex items-center justify-center mb-10">
    <div class="flex flex-col items-center gap-1">
      <div id="step-1-dot" class="step-dot active">1</div>
      <span class="text-xs font-medium" style="color:var(--accent-light);">Describe</span>
    </div>

    <div id="step-connector" class="step-connector pending mx-2"></div>

    <div class="flex flex-col items-center gap-1">
      <div id="step-2-dot" class="step-dot pending">2</div>
      <span class="text-xs" style="color:var(--text-muted);">Generate</span>
    </div>
  </div>

  <!-- Step 1: Describe -->
  <div id="create-step-1" class="flex flex-col gap-6 max-w-2xl mx-auto w-full">

    <!-- Project Name -->
    <div>
      <label class="block text-sm font-medium text-secondary mb-2" for="project-name">
        Project Name <span style="color:var(--accent);">*</span>
      </label>
      <input
        id="project-name"
        type="text"
        placeholder="my-awesome-app"
        class="input w-full"
        maxlength="64"
        autocomplete="off"
        spellcheck="false"
      />
      <p class="text-xs text-muted mt-1">Lowercase letters, numbers, and hyphens only.</p>
    </div>

    <!-- Framework Selection -->
    <div>
      <label class="block text-sm font-medium text-secondary mb-3">
        Framework <span style="color:var(--accent);">*</span>
      </label>
      <div id="framework-grid" class="grid grid-cols-2 gap-3">
        <!-- Framework cards injected by App.renderFrameworks() -->
      </div>
    </div>

    <!-- Requirements -->
    <div>
      <label class="block text-sm font-medium text-secondary mb-2" for="project-requirements">
        Project Requirements <span style="color:var(--accent);">*</span>
      </label>
      <textarea
        id="project-requirements"
        rows="6"
        placeholder="Describe what you want to build in detail...&#10;&#10;Example: A REST API with user authentication, CRUD operations for products, PostgreSQL database, and JWT tokens."
        class="input w-full resize-none"
        maxlength="4000"
        oninput="
          var counter = document.getElementById('req-counter');
          if(counter) counter.textContent = this.value.length + ' / 4000';
        "
      ></textarea>
      <div class="flex justify-end mt-1">
        <span id="req-counter" class="char-counter">0 / 4000</span>
      </div>
    </div>

    <!-- Analyze Button -->
    <div class="flex justify-end">
      <button class="btn btn-primary flex items-center gap-2" onclick="App.analyzeRequirements()">
        <i class="fas fa-magic"></i>
        Analyze Requirements
      </button>
    </div>

  </div>

  <!-- Step 2: Generate -->
  <div id="create-step-2" class="hidden flex-col gap-6 max-w-2xl mx-auto w-full">

    <!-- Analysis Results -->
    <div>
      <label class="block text-sm font-medium text-secondary mb-2">Analysis Results</label>
      <div
        id="analysis-result"
        class="rounded-xl p-4 text-sm"
        style="
          background:var(--bg-elevated);
          border:1px solid var(--border-subtle);
          color:var(--text-secondary);
          max-height:320px;
          overflow-y:auto;
          white-space:pre-wrap;
          font-family:var(--font-mono, 'JetBrains Mono', monospace);
          line-height:1.6;
        "
      >
        <!-- Analysis markdown injected here -->
      </div>
    </div>

    <!-- Step 2 Actions -->
    <div class="flex items-center gap-3 justify-end">
      <button class="btn btn-ghost flex items-center gap-2" onclick="App.backToStep1()">
        <i class="fas fa-arrow-left"></i>
        Back
      </button>
      <button class="btn btn-primary flex items-center gap-2" onclick="App.generateProject()">
        <i class="fas fa-rocket"></i>
        Generate Project
      </button>
    </div>

  </div>

</div>
<!-- /SCREEN: CREATE -->


<!-- ============================================================
     SCREEN: EDITOR
     ============================================================ -->
<div id="screen-editor" class="screen hidden flex flex-col" style="height:calc(100vh - 4rem);">

  <!-- Editor Top Bar -->
  <div class="flex items-center gap-3 px-4 py-2 flex-shrink-0"
       style="border-bottom:1px solid rgba(99,102,241,0.08);background:var(--bg-surface);">

    <!-- Breadcrumb -->
    <nav id="editor-breadcrumb" class="breadcrumb flex items-center gap-1 text-sm flex-1 min-w-0">
      <span class="text-muted">Projects</span>
      <i class="fas fa-chevron-right text-xs text-muted"></i>
      <span id="editor-project-name" class="text-primary font-medium truncate">--</span>
    </nav>

    <!-- Framework Badge -->
    <span id="editor-framework-badge" class="badge-indigo hidden text-xs flex-shrink-0">--</span>

    <!-- Action Buttons -->
    <div class="flex items-center gap-2 flex-shrink-0">
      <button class="btn btn-ghost btn-sm flex items-center gap-1.5 text-sm" onclick="App.saveCurrentFile()" title="Save (⌘S)">
        <i class="fas fa-save"></i>
        <span class="hidden sm:inline">Save</span>
      </button>
      <button id="btn-run" class="btn btn-primary btn-sm flex items-center gap-1.5 text-sm" onclick="App.runProject()" title="Run project">
        <i class="fas fa-play"></i>
        <span class="hidden sm:inline">Run</span>
      </button>
      <button id="btn-stop" class="btn btn-ghost btn-sm flex items-center gap-1.5 text-sm hidden" onclick="App.stopExecution()" title="Stop">
        <i class="fas fa-stop"></i>
        <span class="hidden sm:inline">Stop</span>
      </button>
      <button class="btn btn-ghost btn-sm flex items-center gap-1.5 text-sm" onclick="App.showScreen('dashboard')" title="Back to dashboard">
        <i class="fas fa-th-large"></i>
      </button>
    </div>

  </div>

  <!-- Three-Column Editor Layout -->
  <div class="flex flex-1 min-h-0 overflow-hidden">

    <!-- LEFT: File Tree (w-56) -->
    <div class="flex flex-col flex-shrink-0"
         style="width:14rem;border-right:1px solid rgba(99,102,241,0.08);background:var(--bg-surface);">

      <div class="flex items-center justify-between px-3 py-2 flex-shrink-0"
           style="border-bottom:1px solid rgba(99,102,241,0.08);">
        <span class="text-xs font-semibold uppercase tracking-wider text-muted">Files</span>
        <button class="btn btn-ghost p-1 text-xs" onclick="App.refreshFiles()" title="Refresh file tree">
          <i class="fas fa-sync-alt"></i>
        </button>
      </div>

      <div id="file-tree" class="flex-1 overflow-y-auto py-1">
        <!-- File items injected by App.renderFileTree() -->
        <div class="px-3 py-6 text-center text-xs text-muted">
          <i class="fas fa-folder-open mb-2 text-lg opacity-40"></i>
          <div>No files loaded</div>
        </div>
      </div>

    </div>
    <!-- /LEFT -->

    <!-- CENTER: Code Editor -->
    <div class="flex flex-col flex-1 min-w-0 min-h-0">

      <!-- Editor Tabs Row -->
      <div id="editor-tabs"
           class="flex items-center gap-0 flex-shrink-0 overflow-x-auto"
           style="border-bottom:1px solid rgba(99,102,241,0.08);background:var(--bg-base);min-height:2.25rem;">
        <!-- Tabs injected by App.openFile() -->
      </div>

      <!-- CodeMirror Container -->
      <div id="code-editor" class="flex-1 min-h-0 overflow-hidden">
        <!-- CodeMirror instance mounted here -->
      </div>

      <!-- Editor Placeholder (no file open) -->
      <div id="editor-placeholder"
           class="flex flex-col items-center justify-center flex-1 gap-4"
           style="color:var(--text-muted);">
        <i class="fas fa-file-code text-5xl opacity-20"></i>
        <div class="text-center">
          <p class="font-medium text-secondary mb-1">No file open</p>
          <p class="text-sm text-muted">Select a file from the tree to start editing</p>
        </div>
      </div>

      <!-- Terminal Panel (collapsible bottom) -->
      <div id="terminal-panel"
           class="flex-shrink-0"
           style="height:10rem;border-top:1px solid rgba(99,102,241,0.08);background:#020209;display:none;flex-direction:column;">

        <div class="flex items-center justify-between px-3 py-1.5 flex-shrink-0"
             style="border-bottom:1px solid rgba(255,255,255,0.06);">
          <div class="flex items-center gap-2 text-xs text-muted">
            <i class="fas fa-terminal"></i>
            <span class="font-mono">Terminal</span>
          </div>
          <div class="flex items-center gap-2">
            <button class="btn btn-ghost p-1 text-xs" onclick="App.clearTerminal()" title="Clear">
              <i class="fas fa-trash-alt"></i>
            </button>
            <button class="btn btn-ghost p-1 text-xs" onclick="App.toggleTerminal()" title="Close">
              <i class="fas fa-times"></i>
            </button>
          </div>
        </div>

        <div id="terminal-output"
             class="flex-1 overflow-y-auto px-3 py-2 font-mono text-xs"
             style="color:#a3e635;line-height:1.6;">
          <!-- Terminal lines injected -->
        </div>

      </div>
      <!-- /Terminal Panel -->

    </div>
    <!-- /CENTER -->

    <!-- RIGHT: AI Chat Panel (w-72) -->
    <div id="chat-panel"
         class="flex flex-col flex-shrink-0"
         style="width:18rem;border-left:1px solid rgba(99,102,241,0.08);background:var(--bg-surface);">

      <!-- Chat Header -->
      <div class="flex items-center gap-2 px-3 py-2 flex-shrink-0"
           style="border-bottom:1px solid rgba(99,102,241,0.08);">
        <div class="w-7 h-7 rounded-full flex items-center justify-center"
             style="background:var(--accent);font-size:0.7rem;">
          <i class="fas fa-robot text-white"></i>
        </div>
        <div class="flex-1 min-w-0">
          <div class="text-sm font-semibold text-primary">AI Assistant</div>
          <div class="text-xs text-muted">Ask anything about your code</div>
        </div>
        <span class="status-badge online" style="font-size:0.6rem;">Live</span>
      </div>

      <!-- Chat Messages -->
      <div id="chat-messages"
           class="flex-1 overflow-y-auto px-3 py-3 flex flex-col gap-3">

        <!-- Initial AI welcome message -->
        <div class="chat-msg ai">
          <div class="chat-msg-bubble">
            <p>Hi! I'm your AI coding assistant. I can help you:</p>
            <ul class="mt-2 space-y-1 text-sm" style="list-style:disc;padding-left:1rem;">
              <li>Explain or refactor code</li>
              <li>Fix bugs and errors</li>
              <li>Add new features</li>
              <li>Answer questions</li>
            </ul>
            <p class="mt-2 text-xs text-muted">Select a file and start typing!</p>
          </div>
        </div>

      </div>

      <!-- Typing Indicator -->
      <div id="typing-indicator" class="typing-indicator hidden px-3 pb-2">
        <span></span><span></span><span></span>
      </div>

      <!-- Chat Input -->
      <div class="flex-shrink-0 px-3 py-2" style="border-top:1px solid rgba(99,102,241,0.08);">
        <div class="flex items-end gap-2">
          <textarea
            id="chat-input"
            rows="2"
            placeholder="Ask about the code..."
            class="input flex-1 resize-none text-sm"
            style="min-height:2.5rem;max-height:8rem;"
            onkeydown="
              if(event.key==='Enter' && !event.shiftKey){
                event.preventDefault();
                App.sendChatMessage();
              }
            "
          ></textarea>
          <button class="btn btn-primary p-2.5 flex-shrink-0" onclick="App.sendChatMessage()" title="Send (Enter)">
            <i class="fas fa-paper-plane text-sm"></i>
          </button>
        </div>
        <p class="text-xs text-muted mt-1">Enter to send, Shift+Enter for newline</p>
      </div>

    </div>
    <!-- /RIGHT -->

  </div>
  <!-- /Three-Column Layout -->

</div>
<!-- /SCREEN: EDITOR -->


<!-- ============================================================
     SCREEN: SETTINGS
     ============================================================ -->
<div id="screen-settings" class="screen hidden flex flex-col">

  <!-- Header -->
  <div class="flex items-center gap-4 mb-8">
    <button class="btn btn-ghost flex items-center gap-2" onclick="App.showScreen('dashboard')">
      <i class="fas fa-arrow-left"></i>
    </button>
    <div>
      <h1 class="text-3xl font-bold gradient-text mb-1">Settings</h1>
      <p class="text-secondary">Customize your experience</p>
    </div>
  </div>

  <div class="max-w-2xl mx-auto w-full flex flex-col gap-6">

    <!-- Profile Section -->
    <div class="card" style="padding:1.5rem;">
      <h2 class="text-sm font-semibold uppercase tracking-wider text-muted mb-4">Profile</h2>
      <div class="flex items-center gap-4">
        <img
          id="settings-avatar"
          src="https://ui-avatars.com/api/?name=User&background=6366f1&color=fff&size=64"
          alt="Avatar"
          class="w-16 h-16 rounded-full object-cover flex-shrink-0"
          style="border:2px solid var(--accent);"
        />
        <div class="flex-1 min-w-0">
          <div id="settings-name" class="text-lg font-semibold text-primary truncate">--</div>
          <div id="settings-email" class="text-sm text-muted truncate">--</div>
          <span class="badge-green mt-1 inline-block">Verified</span>
        </div>
      </div>
    </div>

    <!-- AI Configuration Section -->
    <div class="card" style="padding:1.5rem;">
      <h2 class="text-sm font-semibold uppercase tracking-wider text-muted mb-4">AI Configuration</h2>

      <div class="settings-row">
        <div>
          <div class="settings-label">Ollama Server URL</div>
          <div class="settings-description">Base URL for your local Ollama instance</div>
        </div>
        <div class="flex items-center gap-2 flex-shrink-0">
          <input
            id="settings-ollama-url"
            type="text"
            value="http://localhost:11434"
            class="input text-sm"
            style="width:14rem;"
            placeholder="http://localhost:11434"
            autocomplete="off"
            spellcheck="false"
          />
        </div>
      </div>

      <div class="settings-row" style="border-bottom:none;">
        <div>
          <div class="settings-label">Active Model</div>
          <div class="settings-description">Currently loaded language model</div>
        </div>
        <div class="flex items-center gap-2 flex-shrink-0">
          <span id="stat-model-settings" class="badge-indigo text-sm">--</span>
          <button class="btn btn-ghost btn-sm text-xs" onclick="App.refreshModel && App.refreshModel()">
            <i class="fas fa-sync-alt"></i>
          </button>
        </div>
      </div>

    </div>

    <!-- Editor Section -->
    <div class="card" style="padding:1.5rem;">
      <h2 class="text-sm font-semibold uppercase tracking-wider text-muted mb-4">Editor</h2>

      <div class="settings-row">
        <div>
          <div class="settings-label">Font Size</div>
          <div class="settings-description">Code editor font size in pixels</div>
        </div>
        <select id="settings-font-size" class="input text-sm flex-shrink-0" style="width:7rem;">
          <option value="12">12px</option>
          <option value="13">13px</option>
          <option value="14" selected>14px</option>
          <option value="15">15px</option>
          <option value="16">16px</option>
          <option value="17">17px</option>
          <option value="18">18px</option>
        </select>
      </div>

      <div class="settings-row">
        <div>
          <div class="settings-label">Tab Size</div>
          <div class="settings-description">Number of spaces per indentation level</div>
        </div>
        <select id="settings-tab-size" class="input text-sm flex-shrink-0" style="width:7rem;">
          <option value="2">2 spaces</option>
          <option value="4" selected>4 spaces</option>
        </select>
      </div>

      <div class="settings-row" style="border-bottom:none;">
        <div>
          <div class="settings-label">Word Wrap</div>
          <div class="settings-description">Wrap long lines in the editor</div>
        </div>
        <label class="toggle-switch flex-shrink-0">
          <input type="checkbox" id="settings-word-wrap" checked />
          <span class="toggle-slider"></span>
        </label>
      </div>

    </div>

    <!-- Save Button -->
    <div class="flex justify-end">
      <button class="btn btn-primary flex items-center gap-2" onclick="App.saveSettings()">
        <i class="fas fa-check"></i>
        Save Settings
      </button>
    </div>

    <!-- Danger Zone -->
    <div class="card" style="padding:1.5rem;border-color:rgba(239,68,68,0.35);">
      <h2 class="text-sm font-semibold uppercase tracking-wider mb-4" style="color:#f87171;">Danger Zone</h2>

      <div class="settings-row" style="border-bottom:none;">
        <div>
          <div class="settings-label" style="color:#f87171;">Sign Out</div>
          <div class="settings-description">End your current session</div>
        </div>
        <a href="/auth/logout"
           class="btn flex items-center gap-2 text-sm flex-shrink-0"
           style="border:1px solid rgba(239,68,68,0.5);color:#f87171;background:rgba(239,68,68,0.08);padding:0.4rem 1rem;border-radius:0.5rem;text-decoration:none;transition:all 0.2s;"
           onmouseover="this.style.background='rgba(239,68,68,0.18)'"
           onmouseout="this.style.background='rgba(239,68,68,0.08)'">
          <i class="fas fa-sign-out-alt"></i>
          Sign Out
        </a>
      </div>

      <div class="settings-row mt-4" style="border-bottom:none;">
        <div>
          <div class="settings-label" style="color:#f87171;">Delete Account</div>
          <div class="settings-description">Permanently remove all data. This cannot be undone.</div>
        </div>
        <button
          class="btn flex items-center gap-2 text-sm flex-shrink-0"
          style="border:1px solid rgba(239,68,68,0.5);color:#f87171;background:rgba(239,68,68,0.08);padding:0.4rem 1rem;border-radius:0.5rem;transition:all 0.2s;"
          onclick="App.confirmDeleteAccount && App.confirmDeleteAccount()"
          onmouseover="this.style.background='rgba(239,68,68,0.18)'"
          onmouseout="this.style.background='rgba(239,68,68,0.08)'">
          <i class="fas fa-trash-alt"></i>
          Delete Account
        </button>
      </div>

    </div>

  </div>

</div>
<!-- /SCREEN: SETTINGS -->
{% endblock %}
